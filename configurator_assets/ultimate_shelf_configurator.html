<!DOCTYPE html>
<html lang="en-GB">
<head>
<!-- ULTIMATE SHELF CONFIGURATOR - Combines all best approaches -->
<script>
// ULTIMATE API CONFIGURATOR INTERCEPTOR - Must be FIRST
(function() {
    console.log('[ULTIMATE-CONFIGURATOR] üöÄ Starting Ultimate API Configurator Interceptor...');
    
    // Store original functions
    const originalFetch = window.fetch;
    const originalXHR = window.XMLHttpRequest;
    
    // Configuration cache
    let configCache = null;
    let translationsCache = null;
    
    // Load configuration synchronously
    async function loadConfiguration() {
        if (configCache && translationsCache) {
            return { config: configCache, translations: translationsCache };
        }
        
        try {
            console.log('[ULTIMATE-CONFIGURATOR] üì• Loading configuration...');
            
            // Load shelf config from API data
            const shelfResponse = await originalFetch('/shelf_config_from_api.json', {
                method: 'GET',
                credentials: 'same-origin'
            });
            
            if (!shelfResponse.ok) {
                throw new Error('Failed to load shelf config');
            }
            
            const shelfConfig = await shelfResponse.json();
            console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Shelf config loaded');
            
            // Add missing fields that conf2.umd.min.js expects
            shelfConfig.productId = 2000003;
            shelfConfig.type = "shelf";
            shelfConfig.component = "shelf";
            shelfConfig.countryId = 16;
            shelfConfig.locale = "en";
            console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Added required fields');
            
            // Load wardrobe config for Russian translations
            const wardrobeResponse = await originalFetch('/wardrobe_config_rubles.json', {
                method: 'GET',
                credentials: 'same-origin'
            });
            
            let translations = {};
            if (wardrobeResponse.ok) {
                const wardrobeConfig = await wardrobeResponse.json();
                console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Wardrobe config loaded');
                
                if (wardrobeConfig.settings && wardrobeConfig.settings.translations) {
                    translations = wardrobeConfig.settings.translations;
                    console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Russian translations loaded');
                }
            }
            
            // Cache the results
            configCache = shelfConfig;
            translationsCache = translations;
            
            return { config: shelfConfig, translations: translations };
            
        } catch (error) {
            console.error('[ULTIMATE-CONFIGURATOR] ‚ùå Error loading configuration:', error);
            throw error;
        }
    }
    
    // Intercept fetch
    window.fetch = async function(input, init) {
        const url = (typeof input === 'string') ? input : (input && input.url) || '';
        console.log('[ULTIMATE-CONFIGURATOR] üîç Fetch request:', url);
        
        if (url.includes('condor.pickawood.com/configuration') || url.includes('/configuration/')) {
            console.log('[ULTIMATE-CONFIGURATOR] üéØ Intercepting fetch:', url);
            
            try {
                const { config, translations } = await loadConfiguration();
                
                // Add translations to config
                config.translations = {
                    "en": translations
                };
                
                // Set up window.translations
                window.translations = {
                    "en": translations
                };
                
                console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Returning intercepted config');
                
                return new Response(JSON.stringify(config), {
                    status: 200,
                    statusText: 'OK',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    }
                });
            } catch (error) {
                console.error('[ULTIMATE-CONFIGURATOR] ‚ùå Fetch interception error:', error);
                return originalFetch(input, init);
            }
        }
        
        return originalFetch(input, init);
    };
    
    // Intercept XMLHttpRequest
    window.XMLHttpRequest = function() {
        const xhr = new originalXHR();
        const originalOpen = xhr.open;
        const originalSend = xhr.send;
        
        xhr.open = function(method, url, ...args) {
            this._url = url;
            console.log('[ULTIMATE-CONFIGURATOR] üîç XHR open:', method, url);
            return originalOpen.apply(this, [method, url, ...args]);
        };
        
        xhr.send = function(body) {
            if (this._url && (this._url.includes('condor.pickawood.com/configuration') || this._url.includes('/configuration/'))) {
                console.log('[ULTIMATE-CONFIGURATOR] üéØ Intercepting XHR:', this._url);
                
                loadConfiguration().then(({ config, translations }) => {
                    // Add translations to config
                    config.translations = {
                        "en": translations
                    };
                    
                    // Set up window.translations
                    window.translations = {
                        "en": translations
                    };
                    
                    const responseText = JSON.stringify(config);
                    
                    Object.defineProperty(this, 'readyState', { value: 4, writable: false });
                    Object.defineProperty(this, 'status', { value: 200, writable: false });
                    Object.defineProperty(this, 'responseText', { value: responseText, writable: false });
                    
                    if (this.onreadystatechange) this.onreadystatechange();
                    if (this.onload) this.onload();
                }).catch(error => {
                    console.error('[ULTIMATE-CONFIGURATOR] ‚ùå XHR Error:', error);
                    return originalSend.apply(this, arguments);
                });
                
                return;
            }
            
            return originalSend.apply(this, arguments);
        };
        
        return xhr;
    };
    
    // More aggressive interception - intercept all network requests
    const originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, ...args) {
        console.log('[ULTIMATE-CONFIGURATOR] üîç XHR.prototype.open:', method, url);
        if (url && (url.includes('condor.pickawood.com/configuration') || url.includes('/configuration/'))) {
            console.log('[ULTIMATE-CONFIGURATOR] üéØ Intercepting XHR.prototype:', url);
            this._intercepted = true;
            this._interceptedUrl = url;
        }
        return originalOpen.apply(this, [method, url, ...args]);
    };

    const originalSend = XMLHttpRequest.prototype.send;
    XMLHttpRequest.prototype.send = function(body) {
        if (this._intercepted) {
            console.log('[ULTIMATE-CONFIGURATOR] üöÄ Sending intercepted XHR:', this._interceptedUrl);

            loadConfiguration().then(({ config, translations }) => {
                // Add translations to config
                config.translations = {
                    "en": translations
                };
                
                // Set up window.translations
                window.translations = {
                    "en": translations
                };
                
                const responseText = JSON.stringify(config);
                
                Object.defineProperty(this, 'readyState', { value: 4, writable: false });
                Object.defineProperty(this, 'status', { value: 200, writable: false });
                Object.defineProperty(this, 'responseText', { value: responseText, writable: false });

                if (this.onreadystatechange) this.onreadystatechange();
                if (this.onload) this.onload();
            }).catch(error => {
                console.error('[ULTIMATE-CONFIGURATOR] ‚ùå XHR.prototype Error:', error);
                return originalSend.apply(this, arguments);
            });

            return;
        }

        return originalSend.apply(this, arguments);
    };
    
    console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Ultimate API Interceptor ready');
})();
</script>

<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="csrf-token" content="is5RrZJQnYyW7i0qj7VzxvQKUsUfdPklSelkUgi3">
<meta name="og:title" content="Design your own bookcase | Bespoke shelving configurator by Pickawood‚Ñ¢">
<meta name="keywords" content="">
<meta name="description" content="Try our 3D shelving configurator and design bespoke bookcases, hanging shelfs or other shelving units | Set height, width and depth between 30 and 600cm">
<meta name="og:description" content="Try our 3D shelving configurator and design bespoke bookcases, hanging shelfs or other shelving units | Set height, width and depth between 30 and 600cm">

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TFQGD2');</script>
<!-- End Google Tag Manager -->

<script src="https://cdn.ablyft.com/s/20190247.js"></script>
<meta property="og:type" content="website" />
<meta property="og:url" content="https://www.pickawood.com/" />
<meta property="og:image" content="/data/pw/pgthumbs/l1_2697.png" />
<link rel="preconnect" href="https://sentry.io">
<link rel="apple-touch-icon" sizes="57x57" href="/gfx/favicon/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/gfx/favicon/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/gfx/favicon/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/gfx/favicon/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/gfx/favicon/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/gfx/favicon/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/gfx/favicon/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/gfx/favicon/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/gfx/favicon/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192" href="/gfx/favicon/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/gfx/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/gfx/favicon/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/gfx/favicon/favicon-16x16.png">
<link rel="manifest" href="/gfx/favicon/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/gfx/favicon/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">
<link rel="manifest" href="/mix-manifest.json?v=5">
<link rel="mask-icon" href="/gfx/favicon/safari-pinned-tab.svg?v=5" color="#5bbad5">
<link rel="shortcut icon" href="/gfx/favicon/favicon.ico?v=5" type="image/x-icon">
<meta name="apple-mobile-web-app-title" content="Pickawood">
<meta name="application-name" content="Pickawood">
<link rel="preconnect" href="https://images.pickawood.com">
<meta name="sentry-trace" content="97d738ebfa0e4e2dbdbedae53988834a-1749ef103af84e4d-1"/><meta name="traceparent" content="00-97d738ebfa0e4e2dbdbedae53988834a-1749ef103af84e4d-01"/><meta name="baggage" content="sentry-trace_id=97d738ebfa0e4e2dbdbedae53988834a,sentry-sample_rate=0.1,sentry-transaction=%2F%7Blocale%7D%2F%7Burl%7D%2F%7Bidentifier%7D,sentry-public_key=333b600eebaa452cb4fa9306c2f59911,sentry-environment=production,sentry-sampled=true"/>
<title>Design your own bookcase | Bespoke shelving configurator by Pickawood‚Ñ¢</title>
<link rel="alternate" hreflang="x-default" href="https://www.pickawood.com/de/configurator/conf2"/>
<link rel="alternate" hreflang="de-DE" href="https://www.pickawood.com/de/configurator/conf2"/>
<link rel="alternate" hreflang="de-CH" href="https://www.pickawood.com/ch/configurator/conf2"/>
<link rel="alternate" hreflang="de-AT" href="https://www.pickawood.com/at/configurator/conf2"/>
<link rel="alternate" hreflang="en" href="https://www.pickawood.com/eu/configurator/conf2"/>
<link rel="alternate" hreflang="fr-FR" href="https://www.pickawood.com/fr/configurateur/conf2"/>
<link rel="alternate" hreflang="it-IT" href="https://www.pickawood.com/it/configurator/conf2"/>
<link rel="alternate" hreflang="nl-NL" href="https://www.pickawood.com/nl/configurator/conf2"/>
<link rel="alternate" hreflang="nl-BE" href="https://www.pickawood.com/be/configurator/conf2"/>
<link rel="stylesheet" href="/css/app.css?id=41943a493838b4792795c3463ab0003b" type="text/css" media="screen">
<style>* { box-sizing: border-box; } body {margin: 0;}</style>

<script>window.env = {"SENTRY_LARAVEL_DSN":"https:\/\/333b600eebaa452cb4fa9306c2f59911@sentry.io\/2404864","POPUP_API":"https:\/\/www.pickawood.com\/api\/popups\/valid","IS_PRODUCTION":true};</script>

<script>
// ULTIMATE CONFIGURATION SETUP - Pre-load everything
console.log('[ULTIMATE-CONFIGURATOR] üöÄ Setting up ultimate configuration...');

// Load configuration immediately
(async function() {
    try {
        console.log('[ULTIMATE-CONFIGURATOR] üì• Pre-loading configuration...');
        
        // Load shelf config from API data
        const shelfResponse = await fetch('/shelf_config_from_api.json', {
            method: 'GET',
            credentials: 'same-origin'
        });
        
        if (!shelfResponse.ok) {
            throw new Error('Failed to load shelf config');
        }
        
        const shelfConfig = await shelfResponse.json();
        console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Shelf config pre-loaded');
        
        // Add missing fields that conf2.umd.min.js expects
        shelfConfig.productId = 2000003;
        shelfConfig.type = "shelf";
        shelfConfig.component = "shelf";
        shelfConfig.countryId = 16;
        shelfConfig.locale = "en";
        console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Added required fields');
        
        // Load wardrobe config for Russian translations
        const wardrobeResponse = await fetch('/wardrobe_config_rubles.json', {
            method: 'GET',
            credentials: 'same-origin'
        });
        
        let translations = {};
        if (wardrobeResponse.ok) {
            const wardrobeConfig = await wardrobeResponse.json();
            console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Wardrobe config pre-loaded');
            
            if (wardrobeConfig.settings && wardrobeConfig.settings.translations) {
                translations = wardrobeConfig.settings.translations;
                console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Russian translations pre-loaded');
            }
        }
        
        // Add translations to config
        shelfConfig.translations = {
            "en": translations
        };
        
        // Store the complete config globally
        window.shelfConfigComplete = shelfConfig;
        window.translations = {
            "en": translations
        };
        
        console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ Complete config pre-loaded and stored');
        console.log('[ULTIMATE-CONFIGURATOR] üîç Complete config keys:', Object.keys(shelfConfig));
        console.log('[ULTIMATE-CONFIGURATOR] üîç Translation keys count:', Object.keys(translations).length);
        
    } catch (error) {
        console.error('[ULTIMATE-CONFIGURATOR] ‚ùå Error pre-loading configuration:', error);
    }
})();

// ULTIMATE CONFIGURATOR CONFIGURATION - Uses real API data
window.conf2config = {
    "productId": 2000003,
    "countryId": 16,
    "locale": "en",
    "type": "shelf",
    "component": "shelf",
    "configurationId": "66ee895bd1034bde9ed7f200c0332261",
    "configurationUrl": "https://www.pickawood.com/en/load-configuration/66ee895bd1034bde9ed7f200c0332261",
    "configUrl": "https://condor.pickawood.com/configuration/2000003/en/GB",
    "configurationSaveUrl": "/en/configurator",
    "configurationCartUrl": "/en/cart/configuration",
    "cartUrl": "https://www.pickawood.com/en/cart",
    "configurationLoadUrl": "/en/configurator",
    "configuratorEntryList": {
        "items": [{
            "product": "shelf",
            "type": "configurable",
            "hash": "66ee895bd1034bde9ed7f200c0332261",
            "image": {
                "default": {
                    "path": "https://images.pickawood.com/data/nettece-2021/Site_structure/conf_entry_items/product_images/product_regale_737x414.png",
                    "width": 737,
                    "height": 414,
                    "alt": "Shelving"
                },
                "sources": [{
                    "type": "image/webp",
                    "media": "",
                    "width": null,
                    "srcset": "https://images.pickawood.com/data/nettece-2021/Site_structure/conf_entry_items/product_images/_thumb_webp/product_regale_737x414.webp"
                }]
            },
            "hover_image": {
                "default": {
                    "path": "https://images.pickawood.com/data/nettece-2021/Site_structure/conf_entry_items/hover_images/hover_regale_768x768.jpg",
                    "width": 768,
                    "height": 768,
                    "alt": "Shelving"
                },
                "sources": [{
                    "type": "image/webp",
                    "media": "(max-width: 750px)and (min-resolution: 2dppx)",
                    "width": 750,
                    "srcset": "https://images.pickawood.com/data/nettece-2021/Site_structure/conf_entry_items/hover_images/_thumb_375-2x/hover_regale_768x768.webp"
                }, {
                    "type": "image/webp",
                    "media": "",
                    "width": null,
                    "srcset": "https://images.pickawood.com/data/nettece-2021/Site_structure/conf_entry_items/hover_images/_thumb_webp/hover_regale_768x768.webp"
                }]
            },
            "title": "Shelving",
            "badge": "",
            "icon": "https://images.pickawood.com/data/nettece-2021/Site_structure/icons_logos/ic_service_saw.svg",
            "text": "Quality craftsmanship from the experts",
            "link": "https://www.pickawood.com/en/configurator/66ee895bd1034bde9ed7f200c0332261",
            "is_small_chip": 0,
            "sort_order": 0
        }]
    },
    "resources": {
        "phone": "0330 80 848 70",
        "email": "support@pickawood.com",
        "appointmentUrl": "/en/appointment"
    }
};

window.isProduction = true;
window.conf2config.noLimits = false;

console.log('[ULTIMATE-CONFIGURATOR] üîß window.conf2config:', window.conf2config);

// Global variables
window.lang = "en";
window.locale = "en";
window.exchange_rate = "0.88";
window.currency_shortcut_shop = "GBP";
window.currency_symbol = "¬£";
window.currency_position = "0";
window.BASEURL = "https://www.pickawood.com";
window.cdn = "https://www.pickawood.com";

// Set up translations
window.translations = {
    "en": {}
};
</script>

<link rel="stylesheet" href="/css/conf2.umd.min.css?id=84dac4f25cc416e009e009428de29a47">
<style>
html, body, #app {
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
}
</style>
</head>
<body>
<div id="app"></div>

<!-- Load Vue.js first -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
<script defer src="/js/conf2.umd.min.js?id=84dac4f25cc416e009e009428de29a47"></script>

<!-- Initialization Script -->
<script>
// Global error handler to catch Canvas errors
window.addEventListener('error', function(e) {
    if (e.message.includes('drawImage') && e.message.includes('CanvasRenderingContext2D')) {
        console.warn('[ULTIMATE-CONFIGURATOR] Canvas error (non-critical):', e.message);
        e.preventDefault(); // Prevent the error from breaking the app
        return false;
    }
});

window.addEventListener('load', function() {
    console.log('[ULTIMATE-CONFIGURATOR] üìÑ Page loaded');
    console.log('[ULTIMATE-CONFIGURATOR] üìÑ Vue:', window.Vue ? '‚úÖ' : '‚ùå');
    console.log('[ULTIMATE-CONFIGURATOR] üìÑ conf2config:', window.conf2config);
    console.log('[ULTIMATE-CONFIGURATOR] üìÑ shelfConfigComplete:', window.shelfConfigComplete ? '‚úÖ' : '‚ùå');
    console.log('[ULTIMATE-CONFIGURATOR] üìÑ translations:', window.translations ? '‚úÖ' : '‚ùå');
    
    // Check if conf2 loaded
    setTimeout(() => {
        console.log('[ULTIMATE-CONFIGURATOR] üîç Checking conf2 after 2 seconds...');
        
        if (window.conf2) {
            console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ window.conf2 found!');
            console.log('[ULTIMATE-CONFIGURATOR] üìã conf2 keys:', Object.keys(window.conf2));
        } else {
            console.log('[ULTIMATE-CONFIGURATOR] ‚ùå window.conf2 not found');
        }
        
        if (window.Vue) {
            console.log('[ULTIMATE-CONFIGURATOR] ‚úÖ window.Vue found!');
        } else {
            console.log('[ULTIMATE-CONFIGURATOR] ‚ùå window.Vue not found');
        }
        
        // Check if there are any global variables that might be related
        const globalVars = Object.keys(window).filter(key =>
            key.includes('conf') || key.includes('Conf') || key.includes('vue') || key.includes('Vue')
        );
        console.log('[ULTIMATE-CONFIGURATOR] üîç Global conf/vue variables:', globalVars);
        
        // Check translations
        if (window.translations && window.translations.en) {
            console.log('[ULTIMATE-CONFIGURATOR] üîç Translation keys:', Object.keys(window.translations.en));
        }
    }, 2000);
});
</script>

</body>
</html>

