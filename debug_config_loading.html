<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="utf-8">
<title>Debug Config Loading</title>
</head>
<body>
<h1>Debug Config Loading</h1>
<div id="debug-info"></div>

<script>
// Debug script to understand how conf2.umd.min.js loads configuration
(function() {
    console.log('[DEBUG] Starting debug script...');
    
    const debugDiv = document.getElementById('debug-info');
    
    // Intercept all possible ways of loading data
    const originalFetch = window.fetch;
    window.fetch = async function(input, init) {
        const url = (typeof input === 'string') ? input : (input && input.url) || '';
        console.log('[DEBUG] üîç Fetch request:', url);
        debugDiv.innerHTML += `<p>Fetch: ${url}</p>`;
        
        if (url.includes('condor.pickawood.com/configuration') || url.includes('/configuration/')) {
            console.log('[DEBUG] üéØ Intercepting fetch:', url);
            debugDiv.innerHTML += `<p style="color: red;">INTERCEPTED FETCH: ${url}</p>`;
            
            // Return our local config
            try {
                const response = await originalFetch('/shelf_config_from_api.json');
                const config = await response.json();
                config.productId = 2000003;
                config.type = "shelf";
                config.component = "shelf";
                
                console.log('[DEBUG] ‚úÖ Returning modified config');
                debugDiv.innerHTML += `<p style="color: green;">‚úÖ Returning modified config with keys: ${Object.keys(config).join(', ')}</p>`;
                
                return new Response(JSON.stringify(config), {
                    status: 200,
                    headers: { 'Content-Type': 'application/json' }
                });
            } catch (error) {
                console.error('[DEBUG] Error:', error);
                debugDiv.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
                throw error;
            }
        }
        
        return originalFetch(input, init);
    };
    
    // Intercept XMLHttpRequest
    const originalXHR = window.XMLHttpRequest;
    window.XMLHttpRequest = function() {
        const xhr = new originalXHR();
        const originalOpen = xhr.open;
        const originalSend = xhr.send;
        
        xhr.open = function(method, url, ...args) {
            this._url = url;
            console.log('[DEBUG] üîç XHR open:', method, url);
            debugDiv.innerHTML += `<p>XHR Open: ${method} ${url}</p>`;
            return originalOpen.apply(this, [method, url, ...args]);
        };
        
        xhr.send = function(body) {
            if (this._url && (this._url.includes('condor.pickawood.com/configuration') || this._url.includes('/configuration/'))) {
                console.log('[DEBUG] üéØ Intercepting XHR:', this._url);
                debugDiv.innerHTML += `<p style="color: red;">INTERCEPTED XHR: ${this._url}</p>`;
                
                // Load our config
                originalFetch('/shelf_config_from_api.json').then(response => response.json()).then(config => {
                    config.productId = 2000003;
                    config.type = "shelf";
                    config.component = "shelf";
                    
                    Object.defineProperty(this, 'readyState', { value: 4, writable: false });
                    Object.defineProperty(this, 'status', { value: 200, writable: false });
                    Object.defineProperty(this, 'responseText', { value: JSON.stringify(config), writable: false });
                    
                    console.log('[DEBUG] ‚úÖ XHR config ready');
                    debugDiv.innerHTML += `<p style="color: green;">‚úÖ XHR config ready with keys: ${Object.keys(config).join(', ')}</p>`;
                    
                    if (this.onreadystatechange) this.onreadystatechange();
                    if (this.onload) this.onload();
                }).catch(error => {
                    console.error('[DEBUG] XHR Error:', error);
                    debugDiv.innerHTML += `<p style="color: red;">XHR Error: ${error.message}</p>`;
                    return originalSend.apply(this, arguments);
                });
                
                return;
            }
            
            return originalSend.apply(this, arguments);
        };
        
        return xhr;
    };
    
    // Intercept XMLHttpRequest.prototype
    const originalOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, ...args) {
        console.log('[DEBUG] üîç XHR.prototype.open:', method, url);
        debugDiv.innerHTML += `<p>XHR.prototype Open: ${method} ${url}</p>`;
        
        if (url && (url.includes('condor.pickawood.com/configuration') || url.includes('/configuration/'))) {
            console.log('[DEBUG] üéØ Intercepting XHR.prototype:', url);
            debugDiv.innerHTML += `<p style="color: red;">INTERCEPTED XHR.prototype: ${url}</p>`;
            this._intercepted = true;
            this._interceptedUrl = url;
        }
        
        return originalOpen.apply(this, [method, url, ...args]);
    };
    
    const originalSend = XMLHttpRequest.prototype.send;
    XMLHttpRequest.prototype.send = function(body) {
        if (this._intercepted) {
            console.log('[DEBUG] üöÄ Sending intercepted XHR:', this._interceptedUrl);
            debugDiv.innerHTML += `<p style="color: orange;">Sending intercepted XHR: ${this._interceptedUrl}</p>`;
            
            originalFetch('/shelf_config_from_api.json').then(response => response.json()).then(config => {
                config.productId = 2000003;
                config.type = "shelf";
                config.component = "shelf";
                
                Object.defineProperty(this, 'readyState', { value: 4, writable: false });
                Object.defineProperty(this, 'status', { value: 200, writable: false });
                Object.defineProperty(this, 'responseText', { value: JSON.stringify(config), writable: false });
                
                console.log('[DEBUG] ‚úÖ XHR.prototype config ready');
                debugDiv.innerHTML += `<p style="color: green;">‚úÖ XHR.prototype config ready with keys: ${Object.keys(config).join(', ')}</p>`;
                
                if (this.onreadystatechange) this.onreadystatechange();
                if (this.onload) this.onload();
            }).catch(error => {
                console.error('[DEBUG] XHR.prototype Error:', error);
                debugDiv.innerHTML += `<p style="color: red;">XHR.prototype Error: ${error.message}</p>`;
                return originalSend.apply(this, arguments);
            });
            
            return;
        }
        
        return originalSend.apply(this, arguments);
    };
    
    console.log('[DEBUG] ‚úÖ Debug interceptors ready');
    debugDiv.innerHTML += `<p style="color: green;">‚úÖ Debug interceptors ready</p>`;
})();
</script>

<!-- Load the original configurator script -->
<script>
window.conf2config = {
    "productId": 2000003,
    "countryId": 16,
    "locale": "en",
    "type": "shelf",
    "component": "shelf",
    "configurationId": "66ee895bd1034bde9ed7f200c0332261",
    "configurationUrl": "https://www.pickawood.com/en/load-configuration/66ee895bd1034bde9ed7f200c0332261",
    "configUrl": "https://condor.pickawood.com/configuration/2000003/en/GB",
    "configurationSaveUrl": "/en/configurator",
    "configurationCartUrl": "/en/cart/configuration",
    "cartUrl": "https://www.pickawood.com/en/cart",
    "configurationLoadUrl": "/en/configurator"
};

console.log('[DEBUG] window.conf2config set:', window.conf2config);
document.getElementById('debug-info').innerHTML += `<p>window.conf2config set: ${JSON.stringify(window.conf2config)}</p>`;
</script>

<!-- Load Vue.js first -->
<script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js" onload="console.log('[DEBUG] Vue.js loaded successfully')" onerror="console.error('[DEBUG] Failed to load Vue.js')"></script>

<script src="/js/conf2.umd.min.js" onload="console.log('[DEBUG] conf2.umd.min.js loaded successfully')" onerror="console.error('[DEBUG] Failed to load conf2.umd.min.js')"></script>

<script>
// Global error handler
window.addEventListener('error', function(e) {
    console.error('[DEBUG] JavaScript Error:', e.error);
    console.error('[DEBUG] Error message:', e.message);
    console.error('[DEBUG] Error filename:', e.filename);
    console.error('[DEBUG] Error lineno:', e.lineno);
    document.getElementById('debug-info').innerHTML += `<p style="color: red;">JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}</p>`;
});

// Check if conf2 loaded
setTimeout(() => {
    console.log('[DEBUG] Checking conf2 after 2 seconds...');
    const debugDiv = document.getElementById('debug-info');
    
    if (window.conf2) {
        debugDiv.innerHTML += `<p style="color: green;">‚úÖ window.conf2 found!</p>`;
        debugDiv.innerHTML += `<p>conf2 keys: ${Object.keys(window.conf2).join(', ')}</p>`;
    } else {
        debugDiv.innerHTML += `<p style="color: red;">‚ùå window.conf2 not found</p>`;
    }
    
    if (window.Vue) {
        debugDiv.innerHTML += `<p style="color: green;">‚úÖ window.Vue found!</p>`;
    } else {
        debugDiv.innerHTML += `<p style="color: red;">‚ùå window.Vue not found</p>`;
    }
    
    // Check if there are any global variables that might be related
    const globalVars = Object.keys(window).filter(key => 
        key.includes('conf') || key.includes('Conf') || key.includes('vue') || key.includes('Vue')
    );
    debugDiv.innerHTML += `<p>Global conf/vue variables: ${globalVars.join(', ')}</p>`;
}, 2000);
</script>

</body>
</html>
